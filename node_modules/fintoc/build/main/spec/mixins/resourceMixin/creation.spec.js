"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const ava_1 = __importDefault(require("ava"));
const client_1 = require("../../../lib/client");
const mixins_1 = require("../../../lib/mixins");
const genericFintocResource_1 = require("../../../lib/resources/genericFintocResource");
const link_1 = require("../../../lib/resources/link");
const initializers_1 = require("../../mocks/initializers");
const complexMockResource_1 = require("./mocks/complexMockResource");
const emptyMockResource_1 = require("./mocks/emptyMockResource");
ava_1.default.before((t) => {
    const ctx = t.context;
    ctx.axiosMock = (0, initializers_1.mockAxios)();
});
ava_1.default.after((t) => {
    const ctx = t.context;
    (0, initializers_1.restore)(ctx.axiosMock);
});
ava_1.default.beforeEach((t) => {
    const ctx = t.context;
    ctx.baseUrl = 'https://test.com';
    ctx.apiKey = 'super_secret_api_key';
    ctx.userAgent = 'fintoc-node/test';
    ctx.params = { first_param: 'first_value', second_param: 'second_value' };
    ctx.client = new client_1.Client({
        baseUrl: ctx.baseUrl,
        apiKey: ctx.apiKey,
        userAgent: ctx.userAgent,
        params: ctx.params,
    });
    ctx.path = '/resources';
    ctx.handlers = {
        update: (object) => object,
        delete: (identifier) => identifier,
    };
});
(0, ava_1.default)('"ResourceMixin" creation empty mock resource', async (t) => {
    const ctx = t.context;
    const methods = [];
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const resource = await emptyMockResource_1.EmptyMockResource._build(ctx.client, ctx.handlers, methods, ctx.path, data);
    t.assert(resource instanceof mixins_1.ResourceMixin);
    t.assert(resource.resource instanceof genericFintocResource_1.GenericFintocResource);
    t.is(resource.resource.id, data.resource.id);
    t.assert(Array.isArray(resource.resources));
    resource.resources.forEach((subResource) => {
        t.assert(subResource instanceof genericFintocResource_1.GenericFintocResource);
    });
});
(0, ava_1.default)('"ResourceMixin" creation complex mock resource', async (t) => {
    const ctx = t.context;
    const methods = [];
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const resource = await complexMockResource_1.ComplexMockResource._build(ctx.client, ctx.handlers, methods, ctx.path, data);
    t.assert(resource instanceof mixins_1.ResourceMixin);
    t.assert(resource.resource instanceof link_1.Link);
    t.is(resource.resource.id, data.resource.id);
    t.assert(Array.isArray(resource.resources));
    resource.resources.forEach((subResource) => {
        t.assert(subResource instanceof genericFintocResource_1.GenericFintocResource);
    });
});
(0, ava_1.default)('"ResourceMixin" creation update delete methods access', async (t) => {
    const ctx = t.context;
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const deleteAndNoUpdateresource = await emptyMockResource_1.EmptyMockResource._build(ctx.client, ctx.handlers, ['delete'], ctx.path, data);
    t.assert(deleteAndNoUpdateresource instanceof mixins_1.ResourceMixin);
    await t.throwsAsync(async () => {
        await deleteAndNoUpdateresource.update();
    }, { instanceOf: TypeError });
    await t.notThrowsAsync(async () => {
        await deleteAndNoUpdateresource.delete();
    });
    // @ts-ignore: property is protected
    const updateAndNoDeleteResource = await emptyMockResource_1.EmptyMockResource._build(ctx.client, ctx.handlers, ['update'], ctx.path, data);
    t.assert(updateAndNoDeleteResource instanceof mixins_1.ResourceMixin);
    await t.throwsAsync(async () => {
        await updateAndNoDeleteResource.delete();
    }, { instanceOf: TypeError });
    await t.notThrowsAsync(async () => {
        await updateAndNoDeleteResource.update();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRpb24uc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zcGVjL21peGlucy9yZXNvdXJjZU1peGluL2NyZWF0aW9uLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw4Q0FBdUI7QUFFdkIsZ0RBQTZDO0FBQzdDLGdEQUFvRDtBQUNwRCx3RkFBcUY7QUFDckYsc0RBQW1EO0FBQ25ELDJEQUE4RDtBQUU5RCxxRUFBa0U7QUFDbEUsaUVBQThEO0FBRTlELGFBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUNoQixNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBQzNCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBQSx3QkFBUyxHQUFFLENBQUM7QUFDOUIsQ0FBQyxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDZixNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBQzNCLElBQUEsc0JBQU8sRUFBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDcEIsTUFBTSxHQUFHLEdBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUUzQixHQUFHLENBQUMsT0FBTyxHQUFHLGtCQUFrQixDQUFDO0lBQ2pDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsc0JBQXNCLENBQUM7SUFDcEMsR0FBRyxDQUFDLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztJQUNuQyxHQUFHLENBQUMsTUFBTSxHQUFHLEVBQUUsV0FBVyxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLENBQUM7SUFDMUUsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQztRQUN0QixPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU87UUFDcEIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNO1FBQ2xCLFNBQVMsRUFBRSxHQUFHLENBQUMsU0FBUztRQUN4QixNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU07S0FDbkIsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7SUFDeEIsR0FBRyxDQUFDLFFBQVEsR0FBRztRQUNiLE1BQU0sRUFBRSxDQUFDLE1BQVcsRUFBRSxFQUFFLENBQUMsTUFBTTtRQUMvQixNQUFNLEVBQUUsQ0FBQyxVQUFrQixFQUFFLEVBQUUsQ0FBQyxVQUFVO0tBQzNDLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQUVILElBQUEsYUFBSSxFQUFDLDhDQUE4QyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRTtJQUMvRCxNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBRTNCLE1BQU0sT0FBTyxHQUFhLEVBQUUsQ0FBQztJQUM3QixNQUFNLElBQUksR0FBRztRQUNYLEVBQUUsRUFBRSxLQUFLO1FBQ1QsVUFBVSxFQUFFLGFBQWE7UUFDekIsU0FBUyxFQUFFO1lBQ1QsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7WUFDeEMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7U0FDekM7UUFDRCxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7S0FDbkQsQ0FBQztJQUNGLG9DQUFvQztJQUNwQyxNQUFNLFFBQVEsR0FBRyxNQUFNLHFDQUFpQixDQUFDLE1BQU0sQ0FDN0MsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FDbEQsQ0FBQztJQUVGLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxZQUFZLHNCQUFhLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLFlBQVksNkNBQXFCLENBQUMsQ0FBQztJQUM3RCxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQzVDLFFBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBZ0IsRUFBRSxFQUFFO1FBQzlDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxZQUFZLDZDQUFxQixDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUEsYUFBSSxFQUFDLGdEQUFnRCxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRTtJQUNqRSxNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBRTNCLE1BQU0sT0FBTyxHQUFhLEVBQUUsQ0FBQztJQUM3QixNQUFNLElBQUksR0FBRztRQUNYLEVBQUUsRUFBRSxLQUFLO1FBQ1QsVUFBVSxFQUFFLGFBQWE7UUFDekIsU0FBUyxFQUFFO1lBQ1QsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7WUFDeEMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7U0FDekM7UUFDRCxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7S0FDbkQsQ0FBQztJQUNGLG9DQUFvQztJQUNwQyxNQUFNLFFBQVEsR0FBRyxNQUFNLHlDQUFtQixDQUFDLE1BQU0sQ0FDL0MsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FDbEQsQ0FBQztJQUVGLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxZQUFZLHNCQUFhLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLFlBQVksV0FBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUM1QyxRQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQWdCLEVBQUUsRUFBRTtRQUM5QyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsWUFBWSw2Q0FBcUIsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFBLGFBQUksRUFBQyx1REFBdUQsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7SUFDeEUsTUFBTSxHQUFHLEdBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUUzQixNQUFNLElBQUksR0FBRztRQUNYLEVBQUUsRUFBRSxLQUFLO1FBQ1QsVUFBVSxFQUFFLGFBQWE7UUFDekIsU0FBUyxFQUFFO1lBQ1QsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7WUFDeEMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7U0FDekM7UUFDRCxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUU7S0FDbkQsQ0FBQztJQUNGLG9DQUFvQztJQUNwQyxNQUFNLHlCQUF5QixHQUFHLE1BQU0scUNBQWlCLENBQUMsTUFBTSxDQUM5RCxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FDckQsQ0FBQztJQUVGLENBQUMsQ0FBQyxNQUFNLENBQUMseUJBQXlCLFlBQVksc0JBQWEsQ0FBQyxDQUFDO0lBRTdELE1BQU0sQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUM3QixNQUFNLHlCQUF5QixDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzNDLENBQUMsRUFBRSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBRTlCLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNoQyxNQUFNLHlCQUF5QixDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUgsb0NBQW9DO0lBQ3BDLE1BQU0seUJBQXlCLEdBQUcsTUFBTSxxQ0FBaUIsQ0FBQyxNQUFNLENBQzlELEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUNyRCxDQUFDO0lBRUYsQ0FBQyxDQUFDLE1BQU0sQ0FBQyx5QkFBeUIsWUFBWSxzQkFBYSxDQUFDLENBQUM7SUFFN0QsTUFBTSxDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzdCLE1BQU0seUJBQXlCLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDM0MsQ0FBQyxFQUFFLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFFOUIsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2hDLE1BQU0seUJBQXlCLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyJ9