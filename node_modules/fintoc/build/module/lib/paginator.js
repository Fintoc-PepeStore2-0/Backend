import { LINK_HEADER_PATTERN } from './constants';
/**
 * Parse a link string and return an object with previous parsed links and the new one.
 *
 * @param object - Object containing already parsed links
 * @param link - String with the link header to parse
 * @returns Object that corresponds to the destructured `object` object and the parsed `link` string
 */
export function parseLink(object, link) {
    const data = LINK_HEADER_PATTERN.exec(link);
    if (data === null || data.groups === undefined) {
        return object;
    }
    const { groups } = data;
    return { ...object, [groups.rel]: groups.url };
}
export function parseLinkHeaders(linkHeader) {
    if (linkHeader === null || linkHeader === undefined) {
        return linkHeader;
    }
    return linkHeader.split(',').reduce(parseLink, {});
}
export async function request(options) {
    const { client, path, headers, params = {}, } = options;
    const response = await client.request({
        method: 'get', url: path, params: params || {}, headers,
    });
    const responseHeaders = parseLinkHeaders(response.headers.link);
    const next = responseHeaders && responseHeaders.next;
    const elements = response.data;
    return { next, elements };
}
export async function* paginate(options) {
    const { client, path, headers, params = {}, } = options;
    let response = await request({
        client, path, headers, params,
    });
    /* eslint-disable no-await-in-loop */
    for (const element of response.elements) {
        yield element;
    }
    while (response.next) {
        response = await request({ client, path: response.next, headers });
        for (const element of response.elements) {
            yield element;
        }
    }
    /* eslint-enable no-await-in-loop */
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9wYWdpbmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWxEOzs7Ozs7R0FNRztBQUNILE1BQU0sVUFBVSxTQUFTLENBQUMsTUFBOEIsRUFBRSxJQUFZO0lBQ3BFLE1BQU0sSUFBSSxHQUFHLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QyxJQUFJLElBQUksS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUMvQyxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBQ0QsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQztJQUN4QixPQUFPLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ2pELENBQUM7QUFZRCxNQUFNLFVBQVUsZ0JBQWdCLENBQzlCLFVBQXFDO0lBRXJDLElBQUksVUFBVSxLQUFLLElBQUksSUFBSSxVQUFVLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDcEQsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUNELE9BQU8sVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3JELENBQUM7QUFFRCxNQUFNLENBQUMsS0FBSyxVQUFVLE9BQU8sQ0FBQyxPQUEyQjtJQUN2RCxNQUFNLEVBQ0osTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxHQUFHLEVBQUUsR0FDbkMsR0FBRyxPQUFPLENBQUM7SUFDWixNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQTZCO1FBQ2hFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxJQUFJLEVBQUUsRUFBRSxPQUFPO0tBQ3hELENBQUMsQ0FBQztJQUNILE1BQU0sZUFBZSxHQUFHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEUsTUFBTSxJQUFJLEdBQUcsZUFBZSxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUM7SUFDckQsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztJQUMvQixPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO0FBQzVCLENBQUM7QUFFRCxNQUFNLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBMkI7SUFDekQsTUFBTSxFQUNKLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sR0FBRyxFQUFFLEdBQ25DLEdBQUcsT0FBTyxDQUFDO0lBQ1osSUFBSSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUM7UUFDM0IsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTTtLQUM5QixDQUFDLENBQUM7SUFDSCxxQ0FBcUM7SUFDckMsS0FBSyxNQUFNLE9BQU8sSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDeEMsTUFBTSxPQUFPLENBQUM7SUFDaEIsQ0FBQztJQUNELE9BQU8sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ25FLEtBQUssTUFBTSxPQUFPLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3hDLE1BQU0sT0FBTyxDQUFDO1FBQ2hCLENBQUM7SUFDSCxDQUFDO0lBQ0Qsb0NBQW9DO0FBQ3RDLENBQUMifQ==