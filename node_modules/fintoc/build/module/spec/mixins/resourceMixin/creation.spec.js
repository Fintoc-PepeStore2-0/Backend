import test from 'ava';
import { Client } from '../../../lib/client';
import { ResourceMixin } from '../../../lib/mixins';
import { GenericFintocResource } from '../../../lib/resources/genericFintocResource';
import { Link } from '../../../lib/resources/link';
import { mockAxios, restore } from '../../mocks/initializers';
import { ComplexMockResource } from './mocks/complexMockResource';
import { EmptyMockResource } from './mocks/emptyMockResource';
test.before((t) => {
    const ctx = t.context;
    ctx.axiosMock = mockAxios();
});
test.after((t) => {
    const ctx = t.context;
    restore(ctx.axiosMock);
});
test.beforeEach((t) => {
    const ctx = t.context;
    ctx.baseUrl = 'https://test.com';
    ctx.apiKey = 'super_secret_api_key';
    ctx.userAgent = 'fintoc-node/test';
    ctx.params = { first_param: 'first_value', second_param: 'second_value' };
    ctx.client = new Client({
        baseUrl: ctx.baseUrl,
        apiKey: ctx.apiKey,
        userAgent: ctx.userAgent,
        params: ctx.params,
    });
    ctx.path = '/resources';
    ctx.handlers = {
        update: (object) => object,
        delete: (identifier) => identifier,
    };
});
test('"ResourceMixin" creation empty mock resource', async (t) => {
    const ctx = t.context;
    const methods = [];
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const resource = await EmptyMockResource._build(ctx.client, ctx.handlers, methods, ctx.path, data);
    t.assert(resource instanceof ResourceMixin);
    t.assert(resource.resource instanceof GenericFintocResource);
    t.is(resource.resource.id, data.resource.id);
    t.assert(Array.isArray(resource.resources));
    resource.resources.forEach((subResource) => {
        t.assert(subResource instanceof GenericFintocResource);
    });
});
test('"ResourceMixin" creation complex mock resource', async (t) => {
    const ctx = t.context;
    const methods = [];
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const resource = await ComplexMockResource._build(ctx.client, ctx.handlers, methods, ctx.path, data);
    t.assert(resource instanceof ResourceMixin);
    t.assert(resource.resource instanceof Link);
    t.is(resource.resource.id, data.resource.id);
    t.assert(Array.isArray(resource.resources));
    resource.resources.forEach((subResource) => {
        t.assert(subResource instanceof GenericFintocResource);
    });
});
test('"ResourceMixin" creation update delete methods access', async (t) => {
    const ctx = t.context;
    const data = {
        id: 'id0',
        identifier: 'identifier0',
        resources: [
            { id: 'id1', identifier: 'identifier1' },
            { id: 'id2', identifier: 'identifier2' },
        ],
        resource: { id: 'id3', identifier: 'identifier3' },
    };
    // @ts-ignore: property is protected
    const deleteAndNoUpdateresource = await EmptyMockResource._build(ctx.client, ctx.handlers, ['delete'], ctx.path, data);
    t.assert(deleteAndNoUpdateresource instanceof ResourceMixin);
    await t.throwsAsync(async () => {
        await deleteAndNoUpdateresource.update();
    }, { instanceOf: TypeError });
    await t.notThrowsAsync(async () => {
        await deleteAndNoUpdateresource.delete();
    });
    // @ts-ignore: property is protected
    const updateAndNoDeleteResource = await EmptyMockResource._build(ctx.client, ctx.handlers, ['update'], ctx.path, data);
    t.assert(updateAndNoDeleteResource instanceof ResourceMixin);
    await t.throwsAsync(async () => {
        await updateAndNoDeleteResource.delete();
    }, { instanceOf: TypeError });
    await t.notThrowsAsync(async () => {
        await updateAndNoDeleteResource.update();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRpb24uc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zcGVjL21peGlucy9yZXNvdXJjZU1peGluL2NyZWF0aW9uLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxJQUFJLE1BQU0sS0FBSyxDQUFDO0FBRXZCLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDcEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDckYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFOUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO0lBQ2hCLE1BQU0sR0FBRyxHQUFRLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDM0IsR0FBRyxDQUFDLFNBQVMsR0FBRyxTQUFTLEVBQUUsQ0FBQztBQUM5QixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUNmLE1BQU0sR0FBRyxHQUFRLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUNwQixNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBRTNCLEdBQUcsQ0FBQyxP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